# E2E Cases for EgressPolicy

- all case about check the `eip` will including tcp, udp and web socket

| Case ID | Title                                                                                                                                                                                                                                                                                                                                                                       | Priority | Smoke | Status | Other |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|-------|--------|-------|
| P00001  | Creating an EgressPolicy fails when an illegal `EgressIP` is used                                                                                                                                                                                                                                                                                                           | p2       | false |        |       |
| P00002  | When `EgressGatewayName` is empty, when creating a cluster-level `EgressPolicy`, the default `EgressGatewa` of the cluster will be used, and the status of `EgressPolicySpec.EgressGatewayName` and `EgressPolicyStatus` is correct                                                                                                                                         | p2       | false |        |       |
| P00003  | When `EgressGatewayName` is empty, when creating a namespace-level `EgressPolicy`, <br/> if there is an annotation related to `EgressGateway` in the annotation of the corresponding namespace, use the `EgressGatewa` marked, if not, use the default `EgressGatewa` of the cluster, check` EgressPolicySpec.EgressGatewayName` and `EgressPolicyStatus` status is correct | p2       | false |        |       |
| P00004  | Creating an EgressPolicy fails when the `EgressIP` is not in the `Ippools` range of the `egressGateway` selected by the `Policy`                                                                                                                                                                                                                                            | p2       | false |        |       |
| P00005  | Creating an EgressPolicy fails when `AppliedTo` is empty                                                                                                                                                                                                                                                                                                                    | p2       | false |        |       |
| P00006  | Creating an EgressPolicy fails when both `AppliedTo.PodSubnet` and `AppliedTo.PodSelector` are set                                                                                                                                                                                                                                                                          | p2       | false |        |       |
| P00007  | When only `AppliedTo.PodSubnet` is set, the egress IP of `Pod` matched with it should be `eip`, and the egress IP of `Pod` not matched should be non-`eip`, and `endpointSlice` is not will be created                                                                                                                                                                      | p1       | true  | done   |       |
| P00008  | When `EgressIP` is empty, both `EgressPolicyStatus.Eip` of `Policy` and the egress IP of the Pod is `defaultEIP` of `egressGateway`, `EgressGatewayStatus` is updated as expected                                                                                                                                                                                           | p1       | true  | done   |       |
| P00009  | When the IP of `EgressIP` is empty and `EgressIP.AllocatorPolicy` is in `rr` mode, `eip` will be obtained from the IP of `EgressGatewaySpec.Ippools`, and the status of `EgressPolicyStatus` and `EgressGatewayStatus` is correct                                                                                                                                           | p2       | false |        |       |
| P00010  | When the IP of `EgressIP` is not empty and `EgressIP.AllocatorPolicy` is in `rr` mode, `EgressIP` will take effect, check `EgressPolicyStatus` and `EgressGatewayStatus` are correct                                                                                                                                                                                        | p2       | false |        |       |
| P00011  | When the `DestSubnet` of `Policy` is empty and the destination IP of the access is not within the range of the IP list in `egressClusterInfo.Status`,<br/>Pod’s egress IP is `eip`                                                                                                                                                                                          | p1       | true  | done   |       |
| P00012  | When the `DestSubnet` of `Policy` is empty and the destination IP of the access is within the IP list range in `egressClusterInfo.Status`,<br/>Pod’s egress IP is not `eip`                                                                                                                                                                                                 | p1       | true  |        |       |
| P00013  | Set `DestSubnet` and `PodSelector`, when accessing the external IP that matches `DestSubnet`, the Pod’s egress IP is `eip`,<br/>When accessing the external IP that does not match `DestSubnet`, the Pod’s egress IP is not `eip`                                                                                                                                           | p1       | true  | done   |       |
| P00014  | Edit `PodSelector` that originally matched `DaemonSet-A` to change it to match `DaemonSet-B`,<br/> `EgressEndpoint` will be updated from `DaemonSet-A` to `DaemonSet-B`,<br/>And the export IP of all Pods in `DaemonSet-A` is changed from `eip` to non-`eip`, and the export IP of all Pods in `DaemonSet-B` is changed from non-`eip` to `eip`                           | p1       | true  | done   |       |
| P00015  | When `EgressIP.UseNodeIP` is `false` and `EgressIP` IP is empty, create `EgressPolicy`, <br/>`EgressPolicyStatus.Eip` and `EgressGatewayStatus.Eips` IP should be empty, and the pod’s egress IP is the IP of the node matched by egressGateway `nodeSelector`                                                                                                              | p1       | true  |        |       |
| P00016  | Creating an `EgressPolicy` fails when `EgressIP.UseNodeIP` is `false` and the IP of `EgressIP` is not empty                                                                                                                                                                                                                                                                 | p2       | false |        |       |
| P00017  | Failed to edite the IP of `EgressIP` of Policy                                                                                                                                                                                                                                                                                                                              | p2       | false |        |       |
| P00018  | Failed to edite the IP of `EgressGatewayName` of Policy                                                                                                                                                                                                                                                                                                                     | p2       | false |        |       |
| P00019  | `EgressGatewayStatus` and `EgressEndpoint` will update as expected after delete the policy, and the Pod's egress IP will change from `eip` to non-`eip`                                                                                                                                                                                                                     | p1       | true  | done   |       |
| P00020  | `namespace-level` policy only takes effect in the namespace it specifies                                                                                                                                                                                                                                                                                                    | p2       | false |        |       |
