# E2E Cases for EgressPolicy

- all case about check the `eip` will including tcp, udp and web socket

| Test Case ID | Title                                                                                                                                                                                                                                                                               | Priority | Smoke | Status | Others |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|-------|--------|--------|
| P00001       | Creating EgressPolicy fails when using an invalid `EgressIP`.                                                                                                                                                                                                                       | p2       | false | done   |        |
| P00002       | When `EgressGatewayName` is empty, creating cluster-level `EgressPolicy` should use the cluster's default `EgressGateway`, and check if `EgressPolicySpec.EgressGatewayName` and `EgressPolicyStatus` are updated correctly.                                                        | p2       | false | done   |        |
| P00003       | When `EgressGatewayName` is empty, creating tenant-level `EgressPolicy` should use the annotated `EgressGateway` if specified in the corresponding tenant's annotations; otherwise, use the cluster's default `EgressGateway`, and check if `EgressPolicySpec.EgressGatewayName` and `EgressPolicyStatus` are updated correctly. | p2       | false | done   |        |
| P00004       | Creating EgressPolicy fails when `EgressIP` is not within the `Ippools` range of the selected `egressGateway`.                                                                                                                                                                    | p2       | false | done   |        |
| P00005       | Creating EgressPolicy fails when `AppliedTo` is empty.                                                                                                                                                                                                                              | p2       | false | done   |        |
| P00006       | Creating `Policy` fails when both `AppliedTo.PodSubnet` and `AppliedTo.PodSelector` are set simultaneously.                                                                                                                                                                       | p2       | false | done   |        |
| P00007       | When only `AppliedTo.PodSubnet` is set, the exit IP of Pods matching the subnet should be `eip`, and Pods without a match should have non-`eip` exit IP; `endpointSlice` should not be created.                                                                          | p1       | true  | done   |        |
| P00008       | When `EgressIP` is empty and `AppliedTo.PodSelector` is set, `EgressPolicyStatus.Eip` and Pod exit IP should be the `defaultEIP` of the `egressGateway`, with `allocatorPolicy` as `default` and `useNodeIP` as `false`. Update `EgressGatewayStatus` as expected.              | p1       | true  | done   |        |
| P00009       | When `EgressIP` is empty, and `EgressIP.AllocatorPolicy` is set to round-robin, `EgressPolicyStatus` and `EgressGatewayStatus` should be updated correctly using an IP from `EgressGatewaySpec.Ippools`.                                                                     | p2       | false | done   |        |
| P00010       | When `EgressIP` is not empty, and `EgressIP.AllocatorPolicy` is set to round-robin, `EgressIP` should take effect. Check if `EgressPolicyStatus` and `EgressGatewayStatus` are updated correctly.                                                                              | p2       | false | done |        |
| P00011       | When `Policy.DestSubnet` is empty and accessing an external IP outside the range of IPs in `egressClusterInfo.Status`, Pod exit IP should be `eip`.                                                                                                                           | p1       | true  | done   |        |
| P00012       | When `Policy.DestSubnet` is empty and accessing an external IP within the range of IPs in `egressClusterInfo.Status`, Pod exit IP should not be `eip`.                                                                                                                       | p1       | true  | done   |        |
| P00013       | Set both `DestSubnet` and `PodSelector`. When accessing an external IP matching `DestSubnet`, Pod exit IP should be `eip`; when accessing an external IP not matching `DestSubnet`, Pod exit IP should not be `eip`.                                                        | p1       | true  | done   |        |
| P00014       | Edit `PodSelector` originally matching `DaemonSet-A` to match `DaemonSet-B`. `EgressEndpoint` should be updated from `DaemonSet-A` to `DaemonSet-B`, and exit IP for all Pods in `DaemonSet-A` should change from `eip` to non-`eip`, and for `DaemonSet-B` from non-`eip` to `eip`.              | p1       | true  | done   |        |
| P00015       | When `EgressIP.UseNodeIP` is `true`, and `EgressIP` is empty, creating `EgressPolicy` should set `EgressPolicyStatus.Eip` and `EgressGatewayStatus.Eips` to empty; Pod exit IP should be the node IP matching `egressGateway` `nodeSelector`.                                       | p1       | true  | done   |        |
| P00016       | When `EgressIP.UseNodeIP` is `true`, and `EgressIP` is empty, modifying `nodeSelector` of `EgressGateway` to match another node should update Pod exit IP to the new node's IP.                                                                                              | p1       | true  | done   |        |
| P00017       | Creating `EgressPolicy` fails when `EgressIP.UseNodeIP` is `true`, and `EgressIP` is not empty.                                                                                                                                                                                 | p2       | false | done   |        |
| P00018       | Editing `EgressIP` IP in `Policy` should result in an error.                                                                                                                                                                                                                        | p2       | false | done   |        |
| P00019       | Editing `EgressGatewayName` in `Policy` should result in an error.                                                                                                                                                                                                                 | p2       | false | done   |        |
| P00020       | When deleting `Policy`, `EgressGatewayStatus` and `EgressEndpoint` should be updated as expected, and Pod exit IP should change from `eip` to non-`eip`.                                                                                                                   | p1       | true  | done   |        |
| P00021       | `Namespace-level` Policy should only take effect in the specified namespace.                                                                                                                                                                                                       | p2       | false | done   |        |
