<!--
# E2E Cases for Reliability

| Case ID | Title                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Priority | Smoke   | Status | Other |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|---------|--------|-------|
| R00001  | Use `kwok` to create 10 `Node`, create `Deployment` with 1000 replicas, create `Policy` and set `PodSelector` to match `Deployment`,<br/>all matched `Pod`'s egress IP in the real node is `eip`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | p3       | false   |        |       |
| R00002  | Use `kwok` to create 10 `Node`, create `Deployment` with 1000 replicas, create `Policy` and set `PodSelector` to match `Deployment`,<br/>After restarting `Deployment` successfully, all matched `Pod`'s egress IP in the real node is `eip`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | p3       | false   |        |       |
| R00003  | Use `kwok` to create 1000 `Node`, create EgressGateway and set `NodeSelector` to match the created 1000 `node`, `EgressGatewayStatus.NodeList` will be updated as expected. <br/> Change `NodeSelector` to not match the created `node`, `EgressGatewayStatus.NodeList` will be updated as expected                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | p3       | false   |        |       |
| R00004  | Use `kwok` to create 10 `Node`, create 1000 single-replicas `Deployment`, and create 1000 `Policy` correspondingly, set `EgressIP.AllocatorPolicy` to `RR` mode, <br/>after creating successfully `eip` will be evenly distributed on each node                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | p3       | false   |        |       |
| R00005  | When the node where `eip` takes effect is shut down, `eip` will take effect to another node matching `NodeSelector`, and `egressGatewayStatus` and `EgressClusterStatus` are updated as expected, and the `EgressTunnel` corresponding to the shutdown node ` will be deleted and the egress IP will be accessed as expected                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | p3       | false   |        |       |
| R00006  | After shutting down all nodes matched by `NodeSelector` in `egressGateway`,<br/>`Pod`’s egress IP will be changed from `eip` to non-`eip`, `egressGatewayStatus.NodeList` will be empty, and the related `EgressIgnoreCIDR.NodeIP` will be deleted and the `EgressTunnel` corresponding to the shutdown node will be deleted. <br/> After one of the `node` is turned on, `egressgateway` will recover in a short time and record the recovery time, and `eip` will be revalidated as the egress IP of `Pod`, and the `nodeIP` will be added to `EgressIgnoreCIDR.NodeIP` and `node` related information in `egressGatewayStatus.NodeList` is updated correctly, <br/>after all boots, `eip` will only take effect on the first recovered `node`, and `EgressIgnoreCIDR.NodeIP` is updated correct | p3       | false   |        |       |
| R00007  | Restart each component in the cluster (including calico, kube-proxy) `Pod` in turn. During the restart process, the access IP to outside the cluster is the set `eip` before, and the traffic cannot be interrupted. After the cluster returns to normal, `egressgateway` The individual `cr` state of the component is correct                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | p1       | false   |        |       |
-->
# Reliability E2E 用例 

| 用例编号   | 标题                                                                                                                                                                                                                                                                                                                                                                                                                                           | 优先级 | 冒烟    | 状态  | 其他  |
|--------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----|-------|-----|-----|
| R00001 | 使用 `kwok` 创建 10 个 `Node`，创建 1000 个副本的 `Deployment`，创建 `Policy` 并设置 `PodSelector`，使之与 `Deployment` 匹配，<br/> 真实节点中匹配到的所有 `Pod` 的出口 IP 为 `eip`                                                                                                                                                                                                                                                                                                  | p3  | false |     |     |
| R00002 | 使用 `kwok` 创建 10 个 `Node`，创建 1000 个副本的 `Deployment`，创建 `Policy` 并设置 `PodSelector`，使之与 `Deployment` 匹配，<br/>重启 `Deployment` 成功后， 真实节点中匹配到的所有 `Pod` 的出口 IP 为 `eip`                                                                                                                                                                                                                                                                              | p3  | false |     |     |
| R00003 | 使用 `kwok` 创建 1000 个 `Node`，创建 EgressGateway 并设置 `NodeSelector` 匹配创建的 1000 个 `node`，`EgressGatewayStatus.NodeList` 会如期更新。<br/> 更改 `NodeSelector` 使之与创建的 `node` 不匹配，`EgressGatewayStatus.NodeList` 会如期更新                                                                                                                                                                                                                                       | p3  | false |     |     |
| R00004 | 使用 `kwok` 创建 10 个 `Node`，创建 1000 个单副本的 `Deployment`，并对应创建 1000 个 `Policy` 设置 `EgressIP.AllocatorPolicy` 为轮询模式，<br/>创建成功后 `eip` 会在各个节点上平均分配                                                                                                                                                                                                                                                                                                   | p3  | false |     |     |
| R00005 | 当关机 `eip` 生效的节点后，`eip` 会生效到另外匹配 `NodeSelector` 的节点上，<br/>并且 `egressGatewayStatus` 及 `EgressClusterStatus` 如预期更新，与被关机的节点对应的 `EgressTunnel` 将被删除，出口 IP 如预期访问                                                                                                                                                                                                                                                                                     | p3  | false |     |     |
| R00006 | 当关机 `egressGateway` 中 `NodeSelector` 匹配的所有节点后，<br/>`Pod` 的出口 IP 将由 `eip` 改为非 `eip`，`egressGatewayStatus.NodeList` 将为空，相关的 `EgressIgnoreCIDR.NodeIP` 将被删除，与被关机的节点对应的 `EgressTunnel` 将被删除。<br/> 将其中一个 `node` 开机后，`egressgateway` 会在短时间内恢复并记录恢复时间，并且 `eip` 重新生效为 `Pod` 的出口 IP，`EgressIgnoreCIDR.NodeIP` 将对应的 `nodeIP` 添加并且 `egressGatewayStatus.NodeList` 中 `node` 相关信息更新正确，<br/>全部开机最后 `eip` 只会生效在第一个恢复的 `node` 上，`EgressIgnoreCIDR.NodeIP` 更新正确 | p3  | false |     |     |
| R00007 | 依次重启集群中各个组件（包含 calico，kube-proxy）`Pod`， 重启过程中访问集群外部的出口 IP 为设置好的 `eip`，并且业务不能断流， 等待集群恢复正常后，`egressgateway` 组件的各个 `cr` 状态正确                                                                                                                                                                                                                                                                                                                    | p1  | false |     |     |
| R00008 | 创建 `egressGateway` 分配有 100 个 IP 的池，创建 120 个 policy，做多次删除和创建操作之后，期望 `egressGateway` 及 `Policy` 状态正确, `pod` 的出口 IP 符合预期     | p1  | true |     |     |