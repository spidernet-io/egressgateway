# E2E Cases for Reliability

| Case ID | Title                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Priority | Smoke   | Status | Other |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|---------|--------|-------|
| R00001  | Use `kwok` to create 10 `Node`, create `Deployment` with 1000 replicas, create `Policy` and set `PodSelector` to match `Deployment`,<br/>all matched `Pod`'s egress IP in the real node is `eip`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | p3       | false   |        |       |
| R00002  | Use `kwok` to create 10 `Node`, create `Deployment` with 1000 replicas, create `Policy` and set `PodSelector` to match `Deployment`,<br/>After restarting `Deployment` successfully, all matched `Pod`'s egress IP in the real node is `eip`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | p3       | false   |        |       |
| R00003  | Use `kwok` to create 1000 `Node`, create EgressGateway and set `NodeSelector` to match the created 1000 `node`, `EgressGatewayStatus.NodeList` will be updated as expected. <br/> Change `NodeSelector` to not match the created `node`, `EgressGatewayStatus.NodeList` will be updated as expected                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | p3       | false   |        |       |
| R00004  | Use `kwok` to create 10 `Node`, create 1000 single-replicas `Deployment`, and create 1000 `Policy` correspondingly, set `EgressIP.AllocatorPolicy` to `RR` mode, <br/>after creating successfully `eip` will be evenly distributed on each node                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | p3       | false   |        |       |
| R00005  | When the node where `eip` takes effect is shut down, `eip` will take effect to another node matching `NodeSelector`, and `egressGatewayStatus` and `EgressClusterStatus` are updated as expected, and the `EgressTunnel` corresponding to the shutdown node ` will be deleted and the egress IP will be accessed as expected                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | p3       | false   |        |       |
| R00006  | After shutting down all nodes matched by `NodeSelector` in `egressGateway`,<br/>`Pod`â€™s egress IP will be changed from `eip` to non-`eip`, `egressGatewayStatus.NodeList` will be empty, and the related `EgressIgnoreCIDR.NodeIP` will be deleted and the `EgressTunnel` corresponding to the shutdown node will be deleted. <br/> After one of the `node` is turned on, `egressgateway` will recover in a short time and record the recovery time, and `eip` will be revalidated as the egress IP of `Pod`, and the `nodeIP` will be added to `EgressIgnoreCIDR.NodeIP` and `node` related information in `egressGatewayStatus.NodeList` is updated correctly, <br/>after all boots, `eip` will only take effect on the first recovered `node`, and `EgressIgnoreCIDR.NodeIP` is updated correct | p3       | false   |        |       |
| R00007  | Restart each component in the cluster (including calico, kube-proxy) `Pod` in turn. During the restart process, the access IP to outside the cluster is the set `eip` before, and the traffic cannot be interrupted. After the cluster returns to normal, `egressgateway` The individual `cr` state of the component is correct                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | p1       | false   |        |       |
| R00008  | Create an `egressGateway` with a pool of 100 IPs. Create 120 `policies`. After multiple deletions and creations, expect the `egressGateway` and `Policy` statuses to be correct, and the `pod`'s egress IPs to match expectations                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | p1       | true   |        |       |